<!DOCTYPE html>
<html lang="ja">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Alpine.js 無限ループスライダー（はみ出し透過）</title>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    /* コンテンツ幅の外側を見せるための調整 */
    .carousel-container {
      overflow: visible !important;
    }
  </style>
</head>

<body class="bg-gray-100 overflow-x-hidden"> <div class="py-12">
    <div x-data="carousel" @mouseenter="stopAutoplay()" @mouseleave="startAutoplay()" class="relative w-full overflow-hidden">
      
      <div class="max-w-6xl mx-auto px-5 relative">
        
        <div class="carousel-container">
          
          <div class="flex transition-transform" 
               :class="isTransitioning ? 'duration-500 ease-out' : 'duration-0'"
               :style="`transform: translateX(-${currentIndex * (100 / itemsToShow)}%)`"
               @transitionend="handleTransitionEnd()">
            
            <template x-for="(image, index) in displayImages" :key="index">
              <div class="flex-none px-2 transition-opacity duration-500" 
                   :style="`width: ${100 / itemsToShow}%`"
                   :class="isItemActive(index) ? 'opacity-100' : 'opacity-25'">
                
                <div class="overflow-hidden bg-white rounded-lg shadow-md group h-full">
                  <div class="relative h-48 overflow-hidden">
                    <img :src="image.img" class="object-cover w-full h-full transition-transform duration-500 group-hover:scale-110">
                    <div class="absolute top-2 left-2 bg-black/60 text-white text-xs px-2 py-1 rounded" x-text="image.label"></div>
                  </div>
                  <div class="p-4">
                    <h3 class="text-lg font-bold text-gray-800" x-text="image.label"></h3>
                    <p class="mt-2 text-sm text-gray-600 line-clamp-2" x-text="image.text"></p>
                  </div>
                </div>
              </div>
            </template>
            
          </div>
        </div>

        <button @click="prev()" class="absolute top-1/2 -left-4 z-20 -translate-y-1/2 rounded-full bg-white p-3 shadow-lg hover:bg-gray-50 transition-all focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6 text-gray-800">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5L8.25 12l7.5-7.5"></path>
          </svg>
        </button>

        <button @click="next()" class="absolute top-1/2 -right-4 z-20 -translate-y-1/2 rounded-full bg-white p-3 shadow-lg hover:bg-gray-50 transition-all focus:outline-none">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="size-6 text-gray-800">
            <path stroke-linecap="round" stroke-linejoin="round" d="M8.25 4.5l7.5 7.5-7.5 7.5"></path>
          </svg>
        </button>
      </div>

      <div class="mt-10 flex justify-center gap-2">
        <template x-for="(_, index) in originalImages.length" :key="index">
          <button @click="jumpToIndex(index)" 
                  class="h-2 rounded-full transition-all duration-300"
                  :class="activeDot === index ? 'bg-blue-600 w-6' : 'bg-gray-300 w-2'">
          </button>
        </template>
      </div>

    </div>
  </div>

  <script>
  document.addEventListener('alpine:init', () => {
    Alpine.data('carousel', () => ({
      itemsToShow: 4,
      currentIndex: 0,
      activeDot: 0,
      isTransitioning: true,
      autoplayInterval: 5000,
      timer: null,
      
      originalImages: [
        { id: 1, label: 'Luxury Stay', text: '日常を忘れる、極上のひとときを。', img: '01.jpg' },
        { id: 2, label: 'Fine Dining', text: '厳選された素材による四季折々の料理。', img: '02.jpg' },
        { id: 3, label: 'Relaxation', text: '心と体を整える、至福のスパ体験。', img: '03.jpg' },
        { id: 4, label: 'Beautiful View', text: '窓の外に広がる、息を呑むような絶景。', img: '04.jpg' },
        { id: 5, label: 'Morning Yoga', text: '朝の光を浴びながらのリフレッシュ。', img: '01.jpg' },
        { id: 6, label: 'Private Pool', text: '誰にも邪魔されないプライベート空間。', img: '02.jpg' },
      ],

      get displayImages() {
        // 無限ループ用に前後を複製
        const clones = this.itemsToShow * 2; 
        const lastClones = this.originalImages.slice(-clones);
        const firstClones = this.originalImages.slice(0, clones);
        return [...lastClones, ...this.originalImages, ...firstClones];
      },

      init() {
        this.updateItemsToShow();
        // 初期位置をクローンの後ろ（本物の1枚目）に設定
        this.currentIndex = this.itemsToShow * 2;
        window.addEventListener('resize', () => this.updateItemsToShow());
        this.startAutoplay();
      },

      updateItemsToShow() {
        if (window.innerWidth < 640) this.itemsToShow = 1;
        else if (window.innerWidth < 1024) this.itemsToShow = 2;
        else this.itemsToShow = 4;
      },

      // 表示領域（コンテンツ幅内）にいるかどうかを判定
      isItemActive(index) {
        return index >= this.currentIndex && index < this.currentIndex + this.itemsToShow;
      },

      next() {
        if (!this.isTransitioning) return;
        this.currentIndex++;
        this.updateActiveDot();
      },

      prev() {
        if (!this.isTransitioning) return;
        this.currentIndex--;
        this.updateActiveDot();
      },

      handleTransitionEnd() {
        const clones = this.itemsToShow * 2;
        // 右端に到達
        if (this.currentIndex >= this.originalImages.length + clones) {
          this.isTransitioning = false;
          this.currentIndex = clones;
          setTimeout(() => this.isTransitioning = true, 50);
        }
        // 左端に到達
        if (this.currentIndex <= clones - this.itemsToShow) {
          this.isTransitioning = false;
          this.currentIndex = this.originalImages.length + clones - this.itemsToShow;
          setTimeout(() => this.isTransitioning = true, 50);
        }
      },

      updateActiveDot() {
        const clones = this.itemsToShow * 2;
        let realIndex = (this.currentIndex - clones) % this.originalImages.length;
        if (realIndex < 0) realIndex += this.originalImages.length;
        this.activeDot = realIndex;
      },

      jumpToIndex(index) {
        this.currentIndex = index + (this.itemsToShow * 2);
        this.activeDot = index;
      },

      startAutoplay() {
        this.stopAutoplay();
        this.timer = setInterval(() => this.next(), this.autoplayInterval);
      },

      stopAutoplay() {
        if (this.timer) {
          clearInterval(this.timer);
          this.timer = null;
        }
      }
    }));
  });
  </script>
</body>

</html>